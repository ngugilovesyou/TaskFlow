<!-- src/app/components/todos/todos.html -->

<div class="dashboard-container">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 11l3 3L22 4"></path>
          <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
        </svg>
        <h1>TaskFlow</h1>
      </div>
      <div class="user-info">
  <span class="user-avatar" (click)="toggleDropdown()">
    {{ username.charAt(0).toUpperCase() }}
  </span>

  <!-- Dropdown -->
  <div class="user-dropdown" *ngIf="dropdownOpen">
    <div class="dropdown-user">
      <div class="avatar-circle">{{ username.charAt(0).toUpperCase() }}</div>
      <div class="dropdown-details">
        <strong>{{ username }}</strong><br/>
        <small>User Account</small>
      </div>
    </div>

    <button class="dropdown-btn" (click)="openProfileModal()">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 12c2.21 0 4-1.79 4-4S14.21 4 12 4s-4 1.79-4 4 1.79 4 4 4z"></path>
        <path d="M6 20c0-2.21 2.69-4 6-4s6 1.79 6 4"></path>
      </svg>
      Update Profile
    </button>

    <button class="dropdown-btn logout" (click)="logout()">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
        <polyline points="16 17 21 12 16 7"></polyline>
        <line x1="21" y1="12" x2="9" y2="12"></line>
      </svg>
      Logout
    </button>
  </div>
</div>

    </div>
  </header>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Sidebar Stats -->
    <aside class="sidebar">
      <div class="stats-card">
        <div class="stat-item">
          <div class="stat-icon total">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="8" y1="6" x2="21" y2="6"></line>
              <line x1="8" y1="12" x2="21" y2="12"></line>
              <line x1="8" y1="18" x2="21" y2="18"></line>
              <line x1="3" y1="6" x2="3.01" y2="6"></line>
              <line x1="3" y1="12" x2="3.01" y2="12"></line>
              <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ todos.length }}</span>
            <span class="stat-label">Total Tasks</span>
          </div>
        </div>

        <div class="stat-item">
          <div class="stat-icon active">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ getActiveCount() }}</span>
            <span class="stat-label">Active</span>
          </div>
        </div>

        <div class="stat-item">
          <div class="stat-icon completed">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ getCompletedCount() }}</span>
            <span class="stat-label">Completed</span>
          </div>
        </div>

        <div class="stat-item">
          <div class="stat-icon today">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ getTodayCount() }}</span>
            <span class="stat-label">Today</span>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <h3>Quick Actions</h3>
        <button class="action-btn" (click)="viewMode = 'list'">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="6" x2="21" y2="6"></line>
            <line x1="8" y1="12" x2="21" y2="12"></line>
            <line x1="8" y1="18" x2="21" y2="18"></line>
            <line x1="3" y1="6" x2="3.01" y2="6"></line>
            <line x1="3" y1="12" x2="3.01" y2="12"></line>
            <line x1="3" y1="18" x2="3.01" y2="18"></line>
          </svg>
          List View
        </button>
        <button class="action-btn" (click)="viewMode = 'calendar'">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          Calendar View
        </button>
      </div>
    </aside>

    <!-- Content Area -->
    <div class="content-area">
      <!-- Add Todo Section -->
      <div class="add-todo-section">
        <div class="input-group">
          <input 
            type="text" 
            [(ngModel)]="content" 
            placeholder="What needs to be done?" 
            (keyup.enter)="handleAddTodo()"
            class="todo-input"
          />
          <button class="add-btn" (click)="handleAddTodo()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Add Task
          </button>
        </div>
      </div>

      <!-- List View -->
      <div *ngIf="viewMode === 'list'" class="list-view">
        <!-- Filter Tabs -->
        <div class="filter-tabs">
          <button 
            [class.active]="filterMode === 'all'" 
            (click)="setFilter('all')"
            class="filter-tab">
            All Tasks
          </button>
          <button 
            [class.active]="filterMode === 'active'" 
            (click)="setFilter('active')"
            class="filter-tab">
            Active
          </button>
          <button 
            [class.active]="filterMode === 'completed'" 
            (click)="setFilter('completed')"
            class="filter-tab">
            Completed
          </button>
        </div>

        <!-- Todo List -->
        <div class="todo-list">
          <div *ngIf="filteredTodos.length === 0" class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M9 11l3 3L22 4"></path>
              <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            <h3>No tasks found</h3>
            <p>Add a new task to get started</p>
          </div>

          <div *ngFor="let todo of filteredTodos" class="todo-item" [class.completed]="todo.completed">
            <div class="todo-checkbox">
              <input 
                type="checkbox" 
                [id]="'todo-' + todo.id"
                [checked]="todo.completed" 
                (change)="handleToggle(todo)"
              />
              <label [for]="'todo-' + todo.id" class="checkbox-label"></label>
            </div>
            <div class="todo-content">
              <span class="todo-text">{{ todo.content }}</span>
              <span class="todo-date">{{ todo.created_at | date:'MMM d, y' }}</span>
            </div>
            <button class="delete-btn" (click)="openDeleteModal(todo.id)">
  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <polyline points="3 6 5 6 21 6"></polyline>
    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
  </svg>
</button>

          </div>
        </div>
      </div>

      <!-- Calendar View -->
      <div *ngIf="viewMode === 'calendar'" class="calendar-view">
        <div class="calendar-container">
          <div class="calendar-header">
            <button class="nav-btn" (click)="previousMonth()">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <h2>{{ getMonthYear() }}</h2>
            <button class="nav-btn" (click)="nextMonth()">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>

          <div class="calendar-grid">
            <div class="calendar-day-header">Sun</div>
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>

            <div 
              *ngFor="let day of calendarDays" 
              class="calendar-day"
              [class.today]="isToday(day)"
              [class.selected]="isSelectedDate(day)"
              [class.empty]="!day"
              (click)="selectDate(day)">
              <span *ngIf="day" class="day-number">{{ day.getDate() }}</span>
              <div *ngIf="day && getTodosForDate(day).length > 0" class="todo-indicator">
                <span class="todo-count">{{ getTodosForDate(day).length }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Selected Date Tasks -->
        <div class="selected-date-tasks">
          <h3>Tasks for {{ selectedDate | date:'MMMM d, y' }}</h3>
          <div class="todo-list">
            <div *ngIf="getTodosForSelectedDate().length === 0" class="empty-state small">
              <p>No tasks for this day</p>
            </div>

            <div *ngFor="let todo of getTodosForSelectedDate()" class="todo-item" [class.completed]="todo.completed">
              <div class="todo-checkbox">
                <input 
                  type="checkbox" 
                  [id]="'cal-todo-' + todo.id"
                  [checked]="todo.completed" 
                  (change)="handleToggle(todo)"
                />
                <label [for]="'cal-todo-' + todo.id" class="checkbox-label"></label>
              </div>
              <div class="todo-content">
                <span class="todo-text">{{ todo.content }}</span>
              </div>
              <button class="delete-btn" (click)="openDeleteModal(todo.id)">
  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <polyline points="3 6 5 6 21 6"></polyline>
    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
  </svg>
</button>


            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="profileModalOpen">
  <div class="modal">
    <h2>Update Profile</h2>

    <label>Username</label>
    <input type="text" [(ngModel)]="updatedUsername">

    <label>Password</label>
    <input type="password" [(ngModel)]="updatedPassword">

    <div class="modal-actions">
      <button class="cancel-btn" (click)="closeProfileModal()">Cancel</button>
      <button class="save-btn" (click)="saveProfile()">Save</button>
    </div>
  </div>
</div>
            <!-- TO DELETE MODAL -->
 <div class="delete-modal-backdrop" *ngIf="deleteModalOpen">
  <div class="delete-modal">
    <h2>Confirm Delete</h2>
    <p>Are you sure you want to delete this todo?</p>
    <div class="delete-modal-actions">
      <button class="delete-cancel-btn" (click)="closeDeleteModal()">Cancel</button>
      <button class="delete-confirm-btn" (click)="confirmDelete()">Delete</button>
    </div>
  </div>
</div>
</div>

